<html>
<header>
<meta charset = "utf-8">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jq-3.3.1/dt-1.10.22/b-1.6.5/b-html5-1.6.5/r-2.2.6/sp-1.2.1/sl-1.3.1/datatables.min.css"/>
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<style>
* {
	font-family: 'Roboto', sans-serif;
	font-size: 17px;
}

/* search box */
#main_list_filter {
	float: left;
	text-align: left;
}

/* pagination */
#main_list_paginate {
	text-align: center;
	float: none;
}

/* buttons */
div.dt-buttons {
	float: right;
}
</style>
 
<script type="text/javascript" src="https://cdn.datatables.net/v/dt/jq-3.3.1/dt-1.10.22/b-1.6.5/b-html5-1.6.5/r-2.2.6/sp-1.2.1/sl-1.3.1/datatables.min.js"></script>
<script type="text/javascript" src="js/papaparse.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {

	// Translations
	// https://datatables.net/reference/option/language
	let language = {
		"sProcessing":     "Procesando...",
		"sLengthMenu":     "Mostrar _MENU_ comercios",
		"sZeroRecords":    "No se encontraron resultados",
		"sEmptyTable":     "Ningún dato disponible en esta tabla",
		"sInfo":           "Mostrando comercios del _START_ al _END_ de un total de _TOTAL_ comercios",
		"sInfoEmpty":      "Mostrando comercios del 0 al 0 de un total de 0 comercios",
		"sInfoFiltered":   "(filtrado de un total de _MAX_ comercios)",
		"sInfoPostFix":    "",
		"sSearch":         "Buscar:",
		"sUrl":            "",
		"sInfoThousands":  ",",
		"sLoadingRecords": "Cargando...",
		"oPaginate": {
			"sFirst":    "Primero",
			"sLast":     "Último",
			"sNext":     "Siguiente",
			"sPrevious": "Anterior"
		},
		"oAria": {
			"sSortAscending":  ": Activar para ordenar la columna de manera ascendente",
			"sSortDescending": ": Activar para ordenar la columna de manera descendente"
		},
		"buttons": {
			"copy": "Copiar",
			"colvis": "Visibilidad"
		},
		"searchPanes": {
                "title": {
                    _: 'Filtros seleccionados - %d',
                    0: 'Sin filtros',
                    1: 'Un filtro seleccionado',
                },
				"clearMessage": 'Borrar filtros',
                "collapse": {0: 'Filtros', _: 'Filtros (%d)'}
            }
	};

	// Rendering of columns
	// https://datatables.net/manual/data/renderers
	let renders = {
		"Nombre": function(data, type, row) {
			data = data.trim();
			if (!row.Web.startsWith("http")) {
				row.Web = "https://" + row.Web;
			}
			return type === 'display' ?
                        '<a href="' + row.Web + '">'+ data +'</a>' :
                        data;
		},
		"Municipio": function(data, type, row) {
			data = data.trim();
			return data;
		},
		"Web": function(data, type, row) {
			data = data.trim();
			if (!data.startsWith("http")) {
				data = "https://" + data;
			}
			return type === 'display' ?
                        '<a href="' + data + '">'+ data +'</a>' :
                        data;
		},
		"Twitter / Instagram": function(data, type, row) {
			data = data.trim();
			return type === 'display' ?
                        '<a href="' + data + '">'+ data +'</a>' :
                        data;
		},
	};

	// Responsive classes per column
	// https://datatables.net/extensions/responsive/examples/column-control/classes.html
	let classNames = {
		"Nombre": "all",
		"Tipo": "min-tablet-l",
		"Municipio": "desktop",
		"Web": "desktop",
		"Twitter / Instagram": "desktop"
	};

	// CSV Parser
	Papa.parse("list.csv", {
                    download: true,
					header: true,
					skipEmptyLines: true,
					delimiter: ",",
                    complete: function (results) {
                        if ( results.errors.length ) {
                            console.error(results);
                        }
                        else {
							let columns = [];
							for (i=0; i<results.meta.fields.length; i++){
								let name = results.meta.fields[i];
								columns.push({
									"data": name, 
									"title": name,
									"render": renders[name],
									"className": classNames[name]
								});
							}
                            $('#main_list').DataTable( {
								buttons:[
									'searchPanes'
								],
								dom: 'fBtilp', // order of elements: https://datatables.net/reference/option/dom
								data: results.data,
								columns: columns,
								language: language,
								responsive: {
									details: {
										display: $.fn.dataTable.Responsive.display.childRowImmediate,
										type: 'none',
										target: ''
									}
								},
								pageLength: 20,
								lengthMenu: [ [20, 50, -1], [20, 50, "Todos"] ]
							} );
                        }
                    }
                });
} );
</script>
</header>

<body>
<h1>Compra Online Granada</h1>
<h2>Pequeños comercios de la provincia de Granada con venta online y envío a domicilio</h2>
<table id="main_list" class="display" style="width:100%">
</table>

</body>
</html>